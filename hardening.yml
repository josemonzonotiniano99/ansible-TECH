- name : Hardening - Windows
  #hosts: localhost
  hosts: all
  gather_facts: no
  become: false
  #connection: remote
  vars:
    ansible_python_interpreter: /usr/bin/python3
  tasks:
    - name: Creando directorio temporal
      win_file:
        path: C:\Temp\ansible-PCI
        state: directory

    - name: Transfiriendo script a los hosts
      win_copy:
        #src: /root/awx/projects/Hardening/PCI.ps1
        src: PCI.ps1
        dest: C:\Temp\ansible-PCI\

    - name: Ejecutando Script PCI hardening
      win_shell: C:\Temp\ansible-PCI\PCI.ps1
      args:
        chdir: C:\Temp\ansible-PCI\

    - name: Descargando resultados
      win_copy:
        src: "{{item}}"
        #dest: /root/awx/projects/Hardening/
        dest: /tmp
        with_fileglob: C:\Temp\ansible-PCI\*.txt
        remote_src: True




